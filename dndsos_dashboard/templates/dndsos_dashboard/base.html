{% load static %}
<!doctype html>
<html class="fixed">
	<head>

		<!-- Basic -->
		<meta charset="UTF-8">

        <title>DnD-SOS ‚óè Dashboard</title>
        <link rel="icon" type="image/x-icon" href="{% static 'assets/images/dndsos-logo-white.png' %}">
		<meta name="keywords" content="HTML5 Admin Template" />
		<meta name="description" content="DnD SOS Admin">
		<meta name="author" content="DnD-SOS">

		<!-- Mobile Metas -->
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

		<!-- Web Fonts  -->
		<link href="http://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800|Shadows+Into+Light" rel="stylesheet" type="text/css">

		<!-- Vendor CSS -->
		<link rel="stylesheet" href="{% static 'assets/vendor/bootstrap/css/bootstrap.css' %}" />
		<link rel="stylesheet" href="{% static 'assets/vendor/font-awesome/css/font-awesome.css' %}" />
		<link rel="stylesheet" href="{% static 'assets/vendor/magnific-popup/magnific-popup.css' %}" />
		<link rel="stylesheet" href="{% static 'assets/vendor/bootstrap-datepicker/css/datepicker3.css' %}" />

		<!-- Specific Page Vendor CSS -->
		<link rel="stylesheet" href="{% static 'assets/vendor/jquery-ui/css/ui-lightness/jquery-ui-1.10.4.custom.css' %}" />
		<link rel="stylesheet" href="{% static 'assets/vendor/bootstrap-multiselect/bootstrap-multiselect.css' %}" />
		<link rel="stylesheet" href="{% static 'assets/vendor/morris/morris.css' %}" />

		<!-- Theme CSS -->
		<link rel="stylesheet" href="{% static 'assets/stylesheets/theme.css' %}" />

		<!-- Skin CSS -->
		<link rel="stylesheet" href="{% static 'assets/stylesheets/skins/default.css' %}" />

		<!-- Theme Custom CSS -->
		<link rel="stylesheet" href="{% static 'assets/stylesheets/theme-custom.css' %}">

		<!-- Datatables CSS -->
		<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/jszip-2.5.0/dt-1.10.21/af-2.3.5/b-1.6.2/b-colvis-1.6.2/b-html5-1.6.2/b-print-1.6.2/cr-1.5.2/fc-3.3.1/kt-2.5.2/r-2.2.4/rg-1.1.2/rr-1.2.7/sc-2.0.2/sp-1.1.0/sl-1.3.1/datatables.min.css"/>


		<!-- Head Libs -->
		<script src="{% static 'assets/vendor/modernizr/modernizr.js' %}"></script>


	</head>
	<body>
		<section class="body">
			<!-- start: header -->
			<header class="header">
				<div class="row">
					<div class="col-md-4">
						<div class="logo-container">
							<a href="{% url 'dndsos:home' %}" class="logo">
								<img src="{% static 'assets/images/dndsos-logo-black.png' %}" height="35" alt="DnD-SOS Admin" />
								<span class="h4"><b>DnDSOS</b></span>
							</a>
							<div class="visible-xs toggle-sidebar-left" data-toggle-class="sidebar-left-opened" data-target="html" data-fire-event="sidebar-left-opened">
								<i class="fa fa-bars" aria-label="Toggle sidebar"></i>
							</div>
						</div>		
					</div>
					<div class="col-md-4">
						{% include 'core/_messages.html' %}
					</div>
					<div class="col-md-4">
						<div class="header-right">
				
							<form action="pages-search-results.html" class="search nav-form">
								<div class="input-group input-search">
									<input type="text" class="form-control" name="q" id="q" placeholder="Search...">
									<span class="input-group-btn">
										<button class="btn btn-default" type="submit"><i class="fa fa-search"></i></button>
									</span>
								</div>
							</form>
					
							<span class="separator"></span>
					
							<ul class="notifications">
								<li>
									<a href="#" class="dropdown-toggle notification-icon" data-toggle="dropdown">
										<i class="fa fa-tasks"></i>
										<span class="badge">3</span>
									</a>
					
									<div class="dropdown-menu notification-menu large">
										<div class="notification-title">
											<span class="pull-right label label-default">3</span>
											Tasks
										</div>
					
										<div class="content">
											<ul>
												<li>
													<p class="clearfix mb-xs">
														<span class="message pull-left">Generating Sales Report</span>
														<span class="message pull-right text-dark">60%</span>
													</p>
													<div class="progress progress-xs light">
														<div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;"></div>
													</div>
												</li>
					
												<li>
													<p class="clearfix mb-xs">
														<span class="message pull-left">Importing Contacts</span>
														<span class="message pull-right text-dark">98%</span>
													</p>
													<div class="progress progress-xs light">
														<div class="progress-bar" role="progressbar" aria-valuenow="98" aria-valuemin="0" aria-valuemax="100" style="width: 98%;"></div>
													</div>
												</li>
					
												<li>
													<p class="clearfix mb-xs">
														<span class="message pull-left">Uploading something big</span>
														<span class="message pull-right text-dark">33%</span>
													</p>
													<div class="progress progress-xs light mb-xs">
														<div class="progress-bar" role="progressbar" aria-valuenow="33" aria-valuemin="0" aria-valuemax="100" style="width: 33%;"></div>
													</div>
												</li>
											</ul>
										</div>
									</div>
								</li>
								<li>
									<a href="#" class="dropdown-toggle notification-icon" data-toggle="dropdown">
										<i class="fa fa-envelope"></i>
										<span class="badge">4</span>
									</a>
					
									<div class="dropdown-menu notification-menu">
										<div class="notification-title">
											<span class="pull-right label label-default">230</span>
											Messages
										</div>
					
										<div class="content">
											<ul>
												<li>
													<a href="#" class="clearfix">
														<figure class="image">
															<img src="{% static 'assets/images/sample-user.jpg' %}" alt="Joseph Doe Junior" class="img-circle" />
														</figure>
														<span class="title">Joseph Doe</span>
														<span class="message">Lorem ipsum dolor sit.</span>
													</a>
												</li>
												<li>
													<a href="#" class="clearfix">
														<figure class="image">
															<img src="{% static 'assets/images/sample-user.jpg' %}" alt="Joseph Junior" class="img-circle" />
														</figure>
														<span class="title">Joseph Junior</span>
														<span class="message truncate">Truncated message. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec sit amet lacinia orci. Proin vestibulum eget risus non luctus. Nunc cursus lacinia lacinia. Nulla molestie malesuada est ac tincidunt. Quisque eget convallis diam, nec venenatis risus. Vestibulum blandit faucibus est et malesuada. Sed interdum cursus dui nec venenatis. Pellentesque non nisi lobortis, rutrum eros ut, convallis nisi. Sed tellus turpis, dignissim sit amet tristique quis, pretium id est. Sed aliquam diam diam, sit amet faucibus tellus ultricies eu. Aliquam lacinia nibh a metus bibendum, eu commodo eros commodo. Sed commodo molestie elit, a molestie lacus porttitor id. Donec facilisis varius sapien, ac fringilla velit porttitor et. Nam tincidunt gravida dui, sed pharetra odio pharetra nec. Duis consectetur venenatis pharetra. Vestibulum egestas nisi quis elementum elementum.</span>
													</a>
												</li>
												<li>
													<a href="#" class="clearfix">
														<figure class="image">
															<img src="{% static 'assets/images/sample-user.jpg' %}" alt="Joe Junior" class="img-circle" />
														</figure>
														<span class="title">Joe Junior</span>
														<span class="message">Lorem ipsum dolor sit.</span>
													</a>
												</li>
												<li>
													<a href="#" class="clearfix">
														<figure class="image">
															<img src="{% static 'assets/images/sample-user.jpg' %}" alt="Joseph Junior" class="img-circle" />
														</figure>
														<span class="title">Joseph Junior</span>
														<span class="message">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec sit amet lacinia orci. Proin vestibulum eget risus non luctus. Nunc cursus lacinia lacinia. Nulla molestie malesuada est ac tincidunt. Quisque eget convallis diam.</span>
													</a>
												</li>
											</ul>
					
											<hr />
					
											<div class="text-right">
												<a href="#" class="view-more">View All</a>
											</div>
										</div>
									</div>
								</li>
								<li>
									<a href="#" class="dropdown-toggle notification-icon" data-toggle="dropdown">
										<i class="fa fa-bell"></i>
										<span class="badge">3</span>
									</a>
					
									<div class="dropdown-menu notification-menu">
										<div class="notification-title">
											<span class="pull-right label label-default">3</span>
											Alerts
										</div>
					
										<div class="content">
											<ul id="notifylist"></ul>
											<!-- <ul>
												<li>
													<a href="#" class="clearfix">
														<div class="image">
															<i class="fa fa-thumbs-down bg-danger"></i>
														</div>
														<span class="title">Server is Down!</span>
														<span class="message">Just now</span>
													</a>
												</li>
												<li>
													<a href="#" class="clearfix">
														<div class="image">
															<i class="fa fa-lock bg-warning"></i>
														</div>
														<span class="title">User Locked</span>
														<span class="message">15 minutes ago</span>
													</a>
												</li>
												<li>
													<a href="#" class="clearfix">
														<div class="image">
															<i class="fa fa-signal bg-success"></i>
														</div>
														<span class="title">Connection Restaured</span>
														<span class="message">10/10/2014</span>
													</a>
												</li>
											</ul> -->
					
											<hr />
					
											<div class="text-right">
												<a href="#" class="view-more">View All</a>
											</div>
										</div>
									</div>
								</li>
							</ul>
					
							<span class="separator"></span>
					
							<div id="userbox" class="userbox">
								<a href="#" data-toggle="dropdown">
									<figure class="profile-picture">
										<img src="{% static 'assets/images/logged-user.jpg' %}" alt="Joseph Doe" class="img-circle" data-lock-picture="assets/images/logged-user.jpg' %}" />
									</figure>
									<div class="profile-info" data-lock-name="John Doe" data-lock-email="johndoe@DnD SOS.com">
										<span class="name">{{ user.username }}</span>
										<span class="role">{% if user.is_staff %}administrator{% else %}{% endif %}</span>
									</div>
					
									<i class="fa custom-caret"></i>
								</a>
					
								<div class="dropdown-menu">
									<ul class="list-unstyled">
										<li class="divider"></li>
										<li>
											{% if user.is_employee %}
												<a role="menuitem" tabindex="-1" href="{% url 'dndsos_dashboard:f-profile' f_id=user.pk %}"><i class="fa fa-user"></i> Profile</a>
											{% else %}
												<a role="menuitem" tabindex="-1" href="{% url 'dndsos_dashboard:b-profile' b_id=user.pk %}"><i class="fa fa-user"></i> Profile</a>
											{% endif %}
										</li>
										<li>
											<a role="menuitem" tabindex="-1" href="{% url 'core:logout' %}"><i class="fa fa-power-off"></i> Logout</a>
										</li>
									</ul>
								</div>
							</div>
						</div>
		
					</div>
				</div>


				<!-- start: search & user box -->
				<!-- end: search & user box -->
			</header>
			<!-- end: header -->

			<div class="inner-wrapper">
				<!-- start: sidebar -->
				<aside id="sidebar-left" class="sidebar-left">
				
					<div class="sidebar-header">
						<div class="sidebar-toggle hidden-xs" data-toggle-class="sidebar-left-collapsed" data-target="html" data-fire-event="sidebar-left-toggle">
							<i class="fa fa-bars" aria-label="Toggle sidebar"></i>
						</div>
					</div>
				
					<div class="nano">
						<div class="nano-content">
							<nav id="menu" class="nav-main" role="navigation">
								<ul class="nav nav-main">
									<li class="nav-active">
										{% if user.employer %}
											<a href="{% url 'dndsos_dashboard:b-dashboard' b_id=user.pk %}">
												<i class="fa fa-home" aria-hidden="true"></i>
												<span>Business Dashboard</span>
											</a>
										{% else %}
										<a href="{% url 'dndsos_dashboard:f-dashboard' f_id=user.pk %}">
											<i class="fa fa-home" aria-hidden="true"></i>
											<span>Freelancer Dashboard</span>
										</a>
										{% endif %}
									</li>
									<li>
										{% if user.employee %}
											<a href="{% url 'dndsos_dashboard:f-profile' f_id=user.pk %}">
										{% else %}
											<a href="{% url 'dndsos_dashboard:b-profile' b_id=user.pk %}">
										{% endif %}
											<i class="fa fa-user" aria-hidden="true"></i>
											<span>Profile</span>
										</a>
									</li>
									{% if user.employer %}
										<li>
											<a href="{% url 'dndsos_dashboard:freelancers' b_id=user.pk %}">
												<i class="fa fa-group" aria-hidden="true"></i>
												<span>Freelancers</span>
											</a>
										</li>
	                                    <li>
                                        	<a href="{% url 'dndsos_dashboard:orders' b_id=user.pk %}">
												<i class="fa fa-file-text" aria-hidden="true"></i>
												<span>Orders</span>
											</a>
    	                                </li>
										<li>
											<a href="{% url 'dndsos_dashboard:b-deliveries' b_id=user.pk %}">
												<i class="fa fa-tasks" aria-hidden="true"></i>
												<span>Deliveries</span>
											</a>
										</li>
										<li>
											<a href="{% url 'dndsos_dashboard:b-statistics' b_id=user.pk %}">
												<i class="fa fa-bar-chart-o" aria-hidden="true"></i>
												<span>Statistics</span>
											</a>
										</li>
									{% else %}
										<li>
											<a href="{% url 'dndsos_dashboard:f-deliveries' f_id=user.pk %}">
												<i class="fa fa-tasks" aria-hidden="true"></i>
												<span>Deliveries</span>
											</a>
										</li>
										<li>
											<a href="{% url 'dndsos_dashboard:f-statistics' f_id=user.pk %}">
												<i class="fa fa-bar-chart-o" aria-hidden="true"></i>
												<span>Statistics</span>
											</a>
										</li>
									{% endif %}
								</nav>
				
							<hr class="separator" />

						</div>
				
					</div>
				
				</aside>
				<!-- end: sidebar -->

                {% block content %}
                <!-- CONTENT -->
                {% endblock content %}

			</div>

			<aside id="sidebar-right" class="sidebar-right">
				<div class="nano">
					<div class="nano-content">
						<a href="#" class="mobile-close visible-xs">
							Collapse <i class="fa fa-chevron-right"></i>
						</a>
			
						<div class="sidebar-right-wrapper">
			
							<div class="sidebar-widget widget-calendar">
								<h6>Upcoming Tasks</h6>
								<div data-plugin-datepicker data-plugin-skin="dark" ></div>
			
								<ul>
									<li>
										<time datetime="2014-04-19T00:00+00:00">04/19/2014</time>
										<span>Company Meeting</span>
									</li>
								</ul>
							</div>
			
							<div class="sidebar-widget widget-friends">
								<h6>Friends</h6>
								<ul>
									<li class="status-online">
										<figure class="profile-picture">
											<img src="{% static 'assets/images/sample-user.jpg' %}" alt="Joseph Doe" class="img-circle">
										</figure>
										<div class="profile-info">
											<span class="name">Joseph Doe Junior</span>
											<span class="title">Hey, how are you?</span>
										</div>
									</li>
									<li class="status-online">
										<figure class="profile-picture">
											<img src="{% static 'assets/images/sample-user.jpg' %}" alt="Joseph Doe" class="img-circle">
										</figure>
										<div class="profile-info">
											<span class="name">Joseph Doe Junior</span>
											<span class="title">Hey, how are you?</span>
										</div>
									</li>
									<li class="status-offline">
										<figure class="profile-picture">
											<img src="{% static 'assets/images/sample-user.jpg' %}" alt="Joseph Doe" class="img-circle">
										</figure>
										<div class="profile-info">
											<span class="name">Joseph Doe Junior</span>
											<span class="title">Hey, how are you?</span>
										</div>
									</li>
									<li class="status-offline">
										<figure class="profile-picture">
											<img src="{% static 'assets/images/sample-user.jpg' %}" alt="Joseph Doe" class="img-circle">
										</figure>
										<div class="profile-info">
											<span class="name">Joseph Doe Junior</span>
											<span class="title">Hey, how are you?</span>
										</div>
									</li>
								</ul>
							</div>
			
						</div>
					</div>
				</div>
			</aside>
		</section>

		<!-- Vendor -->

		<!-- <script src="{% static 'assets/vendor/jquery/jquery.js' %}"></script>
		<script src="{% static 'assets/vendor/jquery-browser-mobile/jquery.browser.mobile.js' %}"></script>
		<script src="{% static 'assets/vendor/magnific-popup/magnific-popup.js' %}"></script>
		<script src="{% static 'assets/javascripts/ui-elements/examples.modals.js' %}"></script> -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
		
		<script src="{% static 'assets/vendor/bootstrap/js/bootstrap.js' %}"></script>
		<script src="{% static 'assets/vendor/nanoscroller/nanoscroller.js' %}"></script>
		<script src="{% static 'assets/vendor/bootstrap-datepicker/js/bootstrap-datepicker.js' %}"></script>
		<script src="{% static 'assets/vendor/jquery-placeholder/jquery.placeholder.js' %}"></script>
		

		<!-- Specific Page Vendor -->
		<!-- <script src="{% static 'assets/vendor/jquery-ui/js/jquery-ui-1.10.4.custom.js' %}"></script>
		<script src="{% static 'assets/vendor/jquery-ui-touch-punch/jquery.ui.touch-punch.js' %}"></script>
		<script src="{% static 'assets/vendor/jquery-appear/jquery.appear.js' %}"></script>
		<script src="{% static 'assets/vendor/bootstrap-multiselect/bootstrap-multiselect.js' %}"></script>
		<script src="{% static 'assets/vendor/jquery-easypiechart/jquery.easypiechart.js' %}"></script>
		<script src="{% static 'assets/vendor/flot/jquery.flot.js' %}"></script>
		<script src="{% static 'assets/vendor/flot-tooltip/jquery.flot.tooltip.js' %}"></script>
		<script src="{% static 'assets/vendor/flot/jquery.flot.pie.js' %}"></script>
		<script src="{% static 'assets/vendor/flot/jquery.flot.categories.js' %}"></script>
		<script src="{% static 'assets/vendor/flot/jquery.flot.resize.js' %}"></script>
		<script src="{% static 'assets/vendor/jquery-sparkline/jquery.sparkline.js' %}"></script>
		<script src="{% static 'assets/vendor/raphael/raphael.js' %}"></script>
		<script src="{% static 'assets/vendor/morris/morris.js' %}"></script>
		<script src="{% static 'assets/vendor/gauge/gauge.js' %}"></script>
		<script src="{% static 'assets/vendor/snap-svg/snap.svg.js' %}"></script>
		<script src="{% static 'assets/vendor/liquid-meter/liquid.meter.js' %}"></script>
		<script src="{% static 'assets/vendor/jqvmap/jquery.vmap.js' %}"></script>
		<script src="{% static 'assets/vendor/jqvmap/data/jquery.vmap.sampledata.js' %}"></script>
		<script src="{% static 'assets/vendor/jqvmap/maps/jquery.vmap.world.js' %}"></script>
		<script src="{% static 'assets/vendor/jqvmap/maps/continents/jquery.vmap.africa.js' %}"></script>
		<script src="{% static 'assets/vendor/jqvmap/maps/continents/jquery.vmap.asia.js' %}"></script>
		<script src="{% static 'assets/vendor/jqvmap/maps/continents/jquery.vmap.australia.js' %}"></script>
		<script src="{% static 'assets/vendor/jqvmap/maps/continents/jquery.vmap.europe.js' %}"></script>
		<script src="{% static 'assets/vendor/jqvmap/maps/continents/jquery.vmap.north-america.js' %}"></script>
		<script src="{% static 'assets/vendor/jqvmap/maps/continents/jquery.vmap.south-america.js' %}"></script> -->
		
		<!-- Theme Base, Components and Settings -->
		<script src="{% static 'assets/javascripts/theme.js' %}"></script>
		
		<!-- Theme Custom -->
		<script src="{% static 'assets/javascripts/theme.custom.js' %}"></script>
		
		<!-- Theme Initialization Files -->
		<script src="{% static 'assets/javascripts/theme.init.js' %}"></script>


		<!-- Examples -->
		<!-- <script src="{% static 'assets/javascripts/dashboard/examples.dashboard.js' %}"></script> -->
		<!-- Alerts -->
		<script src="{% static 'assets/javascripts/ui-elements/examples.notifications.js' %}"></script>

		<script src="{% static '/channels/js/websocketbridge.js' %}" type="text/javascript"></script>
		
		{% if user.is_employee %}

		{% include 'dndsos_dashboard/partials/_f-offer-modal.html' %}
		{% include 'dndsos_dashboard/partials/_f-offer-removed-modal.html' %}

			<!-- <script src="{% static 'assets/javascripts/employee_alerts.js' %}" ></script> -->
			<!-- FREELANCER -->
			<script>
				// Open the Freelancer Socket
				console.log('NEW FREELANCER WS')
				const freelancerSocket = new WebSocket(
					'ws://'
					+ window.location.host
					+ '/ws/orders/'
				);
	
				let data;
				let current_order_id;
				let user_id = '{{ user.pk }}'
				
				// Handling incoming message about new offer from business
				freelancerSocket.onmessage = function(e) {
					data = JSON.parse(e.data);
					const data_string = JSON.stringify(e.data);
					console.log(`DATA RECEIVED: ${data.data}`);
					console.log(`ORDER ID: ${data.data.order_id}`);
					console.log(`Pickup Address: ${data.data.pick_up_address}`);
					console.log(`Dropoff Address: ${data.data.drop_off_address}`);
					console.log(`Status: ${data.data.status}`);
					//document.querySelector('#chat-log').value += (data.message + '\n');
					const pick_up_address_e = document.querySelector('#pick_up_address');
					const drop_off_address_e = document.querySelector('#drop_off_address');
					const notes_e = document.querySelector('#notes');
					const order_id = data.data.order_id
					const order_status = data.data.status

					//pick_up_address_e.value = data.data.pick_up_address;
					//drop_off_address_e.value = data.data.drop_off_address;
					let pick_up_address = data.data.pick_up_address;
					let drop_off_address = data.data.drop_off_address;
					$("#pick_up_address").html(pick_up_address)
					$("#drop_off_address").html(drop_off_address)
					$("#notes").html(data.data.notes)
					
					if (current_order_id != order_id) {
						$("#newOfferAlert").modal("show");
					}
					current_order_id = order_id

					if (order_status == 'STARTED' && data.data.freelancer != user_id){
						$('#offerRemoved').modal("show");
					}

				};

				// Handing the acceptance of an offer
				$("#accept").click( function() {
					console.log(`ACCEPTED!!`)
					$('#newOfferAlert').modal('hide');
					
					let freelancer_id = "{{ user.pk }}"
					let freelancer_username = "{{ user.username }}"
					let freelancer_name = "{{ user.employee.name }}"
					let freelancer_email = "{{ user.email }}"
					let freelancer_phone = "{{ user.employee.phone }}"
					console.log(`USERNAME: ${freelancer_username}`)
					console.log(`Email: ${freelancer_email}`)
					console.log(`Phone: ${freelancer_phone}`)
					//console.log(`ORDER ID: ${data.data.order_id}`)
					
					freelancerSocket.send(JSON.stringify({
						'message': 'Freelancer accepted',
						'type': 'update.order', 
						'data': {
							'order_id': data.data.order_id,
							'freelancer': freelancer_id,
							'pick_up_address': data.data.pick_up_address,
							'drop_off_address': data.data.drop_off_address,
							'status': 'STARTED',
							'city': 'cityPlaceHolder'
						}
					}));

					// Refresh the table to update the accepted order
					$.ajax({
						url: "{% url 'orders:deliveries-table' %}",
						success: function(response) {
							$('#deliveriesTable').html(response);
						}
					})		
				})

				// Handing the delivery completion
				stam = function(id,pup,drop) {
					console.log(`DELIVERED!!`)
					let order_id_e = document.querySelector("#orderDelivered");
					let order_id = order_id_e.value;
					let freelancer_id = "{{ user.pk }}";
					let pickup_e = document.querySelector(`#pickupAddress_${order_id}`);
					let dropoff_e = document.querySelector(`#dropoffAddress_${order_id}`);

					current_order_id = order_id

					//pickup_address = pickup_e.value;
					//dropoff_address = dropoff_e.value;
					
					
					console.log(`P: ${pup}`)
					console.log(`D: ${drop}`)
					
					freelancerSocket.send(JSON.stringify({
						'message': 'Freelancer delivered',
						'type': 'update.order', 
						'data': {
							'order_id': order_id,
							'freelancer': freelancer_id,
							'pick_up_address': pup,
							'drop_off_address': drop,
							'status': 'COMPLETED',
							'city': 'cityPlaceHolder'
						}
					}));

					if (current_order_id != order_id) {
						$("#newOfferAlert").modal("show");
						current_order_id = order_id
					}
					
					// Refresh the table to update the accepted order
					$.ajax({
						url: "{% url 'orders:deliveries-table' %}",
						success: function(response) {
							$('#deliveriesTable').html(response);
						}
					})		
				}
	
			</script>
	
		{% else %}
			<!-- <script src="{% static 'assets/javascripts/employer_alerts.js' %}" ></script> -->
			
			<!-- BUSINESS -->
			<script>
				//Open the Order socket from the business side
				const businessSocket = new WebSocket(
					'ws://'
					+ window.location.host
					+ '/ws/orders/'
			
				);    
				console.log('BUSIENSS ORDER WS READY!')

				let user_id = {{ user.pk }}
				let user_username = "{{ user.username }}"
				let user_name = "{{ user.employer.business_name }}"
				let user_email = "{{ user.email }}"
				let street = "{{ user.employer.street }}"
				let building = "{{ user.employer.building_number }}"
				let city = "{{ user.employer.city }}"
				let pick_up_address = building + ' ' + street + ', ' + city
				console.log(`USERNAME: ${user_username}`)
				console.log(`EMail: ${user_email}`)
				console.log(`EER: ${user_name}`)
				console.log(`Address: ${pick_up_address}`)
				
				document.querySelector('#addOrder').onclick = function(e) {
					const street_e = document.querySelector('#street');
					const building_e = document.querySelector('#building');
					const city_e = document.querySelector('#city');
					const notes_e = document.querySelector('#notes');

					const street = street_e.value;
					const building = building_e.value;
					const city = city_e.value;
					const notes = notes_e.value;

					const address = building + ' ' + street + ', ' + city
					console.log(`ADDRESS: ${address}`)

					//const messageInputDom = document.querySelector('#dropOffAddress');
					//const dropOffAddress = messageInputDom.value;
					const dropOffAddress = address;
					businessSocket.send(JSON.stringify({
						'message': dropOffAddress,
						'type': 'create.order', 
						'data': {
							'order_id': 'dummyID',
							'business': user_id,
							'business_name': user_name,
							'pick_up_address': pick_up_address,
							'drop_off_address': dropOffAddress,
							'notes': notes,
							'city': 'cityPlaceHolder'
						}
					}));
					//console.log('RELOADING PAGE to get the new order populated...')
					//location.reload();
					// Reload only the order table.
					$.ajax({
						url: "{% url 'orders:orders-table' %}",
						success: function(response) {
							$('#ordersTable').html(response);
						}
					})		

					$('#modalAddOrder').modal('hide');
										
				};

				// Handling incoming message about new offer
				businessSocket.onmessage = function(e) {
					data = JSON.parse(e.data);
					const data_string = JSON.stringify(e.data);
					console.log(`DATA RECEIVED: ${data.data}`);
					console.log(`ORDER ID: ${data.data.order_id}`);
					console.log(`Freelancer: ${data.data.freelancer}`);

					// Refresh the table to update the accepted order
					$.ajax({
						url: "{% url 'orders:orders-table' %}",
						success: function(response) {
							$('#ordersTable').html(response);
						}
					})		


				};


			</script>

		{% endif %}

		<!-- DATA TABLE -->
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
		<script type="text/javascript" src="https://cdn.datatables.net/v/dt/jszip-2.5.0/dt-1.10.21/af-2.3.5/b-1.6.2/b-colvis-1.6.2/b-html5-1.6.2/b-print-1.6.2/cr-1.5.2/fc-3.3.1/kt-2.5.2/r-2.2.4/rg-1.1.2/rr-1.2.7/sc-2.0.2/sp-1.1.0/sl-1.3.1/datatables.min.js"></script>
		
	<!-- ORDERS -->
	<script>		
		$(document).ready(function() {
			$('#ordersTable').DataTable({
				dom: '',
				dom: 'B<"clear">lfrtip',
				order: [[ 0, "desc" ]], // column 0 (first) ascending order. Or desc for descending
				/*
				*/
				buttons: {
					name: 'default',
					buttons: ['csv', 'excel', 'pdf']
				}
			})
		})
	</script>

	<!-- DELIVERIES -->
	<script>		
		$(document).ready(function() {
			$('#deliveriesTable').DataTable({
				dom: '',
				dom: 'B<"clear">lfrtip',
				order: [[ 0, "desc" ]], // column 0 (first) ascending order. Or desc for descending
				/*
				*/
				buttons: {
					name: 'default',
					buttons: ['csv', 'excel', 'pdf']
				}
			})
		})
	</script>
	<!-- END DATA TABLE -->
	</body>
</html>